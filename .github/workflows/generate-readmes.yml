name: ğŸ–¼ï¸ Auto-Generate Directory Readmes

on:
  push:
    branches:
      - review
    # ğŸš¨ ADJUSTMENT 1: Fixes the 'image deleted' issue by triggering on any change in the repository 
    # and keeps the generate_readmes.py trigger.
    paths-ignore:
      - '**.md'  # Ignore changes to existing READMEs to prevent infinite loops
      - '**.txt' # Ignore other common non-image file types (customize this list)
    
  workflow_dispatch:
    # Manual trigger is enabled but restricted at the job level below.

jobs:
  generate_readmes:
    runs-on: ubuntu-latest
    
    # ğŸš¨ ADJUSTMENT 2: Prevents the workflow from being manually run on the 'main' branch.
    if: |
      github.event_name != 'workflow_dispatch' || (
        github.event_name == 'workflow_dispatch' && 
        github.ref != 'refs/heads/main' &&
        github.ref != 'refs/heads/final' # Add your final branch name if it's 'final'
      )
      
    permissions:
      contents: write
      
    steps:
      - name: â¬‡ï¸ Checkout Repository
        uses: actions/checkout@v4
        with:
          # ğŸš¨ ADJUSTMENT 3: Using the correct, built-in token (secrets.GITHUB_TOKEN)
          token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: ğŸ Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
          
      - name: âš™ï¸ Run README Generation Script
        run: python generate_readmes.py
        
      - name: â¬†ï¸ Commit and Push new README.md Files
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "CI: Auto-generated image thumbnail README.md files"
          file_pattern: '**/README.md'
